import{e as lt,V as U,A as yt,r as v,D as Ve,E as jt,G as Se,H as ue,c as me,I as Je,z as ct,u as Ce,j as e,y as dt,B as j,h as se,s as oe,g as he,X as ut,K as mt,_ as bt,M as ke,O as Oe,P as wt,Q as Fe,k as Nt,R as Ct,S as kt,T as ht,Y as Xe,Z as Ze}from"./index-971aa118.js";import{u as Pt}from"./useWallet-793e28b3.js";import{a as ye,A as Te}from"./contracts-444c63f0.js";import{E as De,P as J,T as pt,a as K}from"./enhanced-assetDaoService-7803e7af.js";import{f as et}from"./api-utils-9109dbff.js";import{m as At,a as Tt}from"./proposalTypeMapping-93b2f350.js";import{C as be,a as we,b as Ee,e as gt,c as Ne,d as xt}from"./card-66a343e3.js";import{u as Ge,P as tt}from"./PageContainer-a070ff6e.js";import{D as ft,f as Dt,a as je,b as X,c as Z,d as ee,e as de,I as Be}from"./label-d4220aab.js";import{A as q,a as G,b as H}from"./alert-1bf7cad7.js";import{I as Me}from"./info-b2324884.js";import{A as Et,P as Ie}from"./page-header-f6ee8f2a.js";import{C as Q}from"./index-cf00c244.js";import{C as Ye}from"./copy-943806b5.js";import{a as Pe,S as Vt,C as St}from"./separator-a60c266b.js";import{C as Ot}from"./clock-6db2a81c.js";import{E as Ft,T as It,a as $t,b as pe,c as ge}from"./tabs-8a3bae7f.js";import{T as vt,R as Lt}from"./triangle-alert-97e99aa3.js";import{z as ae,u as Rt,t as Bt,C as Mt}from"./index-e4e6a023.js";import{F as $e,a as ne,b as ie,c as le,d as xe,e as fe,f as ce}from"./form-45811920.js";import{S as We,a as Ue,b as ze,c as qe,d as te}from"./select-fd573888.js";import{T as Yt}from"./textarea-5192e8e4.js";import{ADDRESSES as st}from"./contracts-7ce1c1bb.js";import{P as Wt}from"./progress-714fd85c.js";import{C as at}from"./circle-alert-23fc46ab.js";import{L as rt}from"./loader-circle-8b712afc.js";import{A as Ut}from"./activity-da0d5bb5.js";import{C as Le,P as Re}from"./plus-94f21ca1.js";import{S as re}from"./skeleton-18e22449.js";import"./chevron-up-4957186b.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=lt("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=lt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);function Gt(){function t(w){const d=w.id||`toast-${Date.now()}`;return w.variant==="destructive"?U.error(w.description,{id:d,duration:w.duration||5e3,position:"top-right"}):U(w.description,{id:d,duration:w.duration||3e3,position:"top-right"})}function o(w){U.dismiss(w)}function i(){U.dismiss()}return{toast:t,dismiss:o,dismissAll:i}}const _t={ZeroAddress:{message:"Invalid address provided",category:"user_error",retryable:!0,suggestedAction:"Please check the token address and try again."},InvalidAmount:{message:"Invalid amount specified",category:"user_error",retryable:!0,suggestedAction:"Amount must be greater than zero."},CallerNotAdmin:{message:"Admin permission required",category:"permission",retryable:!1,suggestedAction:"This action requires admin privileges."},CallerNotOwner:{message:"Owner permission required",category:"permission",retryable:!1,suggestedAction:"This action requires owner privileges."},NotAuthorized:{message:"Not authorized",category:"permission",retryable:!1,suggestedAction:"You do not have permission to perform this action."},ProposalNotFound:{message:"Proposal not found",category:"data",retryable:!1,suggestedAction:"This proposal may have been removed or never existed."},ProposalAlreadyExecuted:{message:"Proposal already executed",category:"data",retryable:!1,suggestedAction:"This proposal has already been processed."},QuorumNotReached:{message:"Quorum not reached",category:"data",retryable:!1,suggestedAction:"The proposal needs more votes before it can be executed."},MajorityNotReached:{message:"Majority not reached",category:"data",retryable:!1,suggestedAction:"The proposal did not receive enough yes votes to pass."},TokenNotWhitelisted:{message:"Token not supported",category:"data",retryable:!1,suggestedAction:"This token is not supported by the protocol."},VotingPeriodEnded:{message:"Voting period ended",category:"data",retryable:!1,suggestedAction:"The voting period for this proposal has ended."},VotingPeriodNotEnded:{message:"Voting still in progress",category:"data",retryable:!1,suggestedAction:"Wait until the voting period ends before executing the proposal."},TimelockPeriodNotElapsed:{message:"Timelock period not elapsed",category:"data",retryable:!0,suggestedAction:"Wait until the timelock period ends before executing the proposal."},"user rejected":{message:"Transaction rejected",category:"user_error",retryable:!0,suggestedAction:"You rejected the transaction request in your wallet."},"insufficient funds":{message:"Insufficient funds",category:"user_error",retryable:!0,suggestedAction:"Add more funds to your wallet to cover transaction costs."},"gas required exceeds allowance":{message:"Gas limit too low",category:"transaction",retryable:!0,suggestedAction:"Try increasing the gas limit in your wallet settings."},"nonce too high":{message:"Transaction sequence error",category:"transaction",retryable:!0,suggestedAction:"Refresh your browser and try again."},"network disconnected":{message:"Network disconnected",category:"network",retryable:!0,suggestedAction:"Check your internet connection and try again."},"execution reverted":{message:"Transaction reverted",category:"transaction",retryable:!0,suggestedAction:"The transaction was reverted by the blockchain. Check your inputs and try again."}};function Ht(t){var $;const o=(t==null?void 0:t.message)||(t==null?void 0:t.reason)||(t==null?void 0:t.toString())||"",i=(($=t==null?void 0:t.code)==null?void 0:$.toString())||"";if(console.debug("Contract error:",{message:o,code:i,error:t}),i==="ACTION_REJECTED")return{message:"Transaction rejected",details:o,category:"user_error",retryable:!0,suggestedAction:"You rejected the transaction in your wallet."};for(const[C,T]of Object.entries(_t))if(o.includes(C))return{message:T.message,details:o,category:T.category,retryable:T.retryable,suggestedAction:T.suggestedAction};if(o.includes("could not detect network")||o.includes("network changed")||o.includes("disconnected")||o.includes("connection error"))return{message:"Network connection issue",details:o,category:"network",retryable:!0,suggestedAction:"Check your internet connection and wallet connection status."};const w=o.replace(/0x[a-fA-F0-9]{8,}/g,"[hex]");return{message:"Transaction failed",details:w.length>150?`${w.substring(0,150)}...`:w,category:"unknown",retryable:!0,suggestedAction:"Please try again or contact support if the issue persists."}}function Qt(t){const o=Ht(t);return o.suggestedAction?`${o.message}: ${o.suggestedAction}`:o.message}const _e=()=>{const{signer:t,isConnected:o}=Pt(),{provider:i,signer:w}=yt(),{toast:d}=Gt(),[$,C]=v.useState(!1),{data:T}=Ve({queryKey:["protocol-metrics"],queryFn:async()=>{try{return await et("/api/protocol/metrics")}catch(l){return console.error("Error fetching protocol metrics:",l),null}},enabled:!0,staleTime:60*1e3}),{data:E,isLoading:W,error:P}=Ve({queryKey:["protocol-dao-proposals"],queryFn:async()=>{try{return await et("/api/protocol/proposals")}catch(l){return console.error("Error fetching protocol proposals:",l),[]}},enabled:!0,staleTime:60*1e3}),{data:L,isLoading:x,error:k,refetch:V}=Ve({queryKey:["asset-dao-proposals"],queryFn:async()=>{if(!i)return[];try{let l;if(i instanceof me)l=i;else if(i instanceof Je)try{l=await i.getSigner().catch(()=>new me("https://sepolia.infura.io/v3/"))}catch{l=new me("https://sepolia.infura.io/v3/")}else l=new me("https://sepolia.infura.io/v3/");const a=t||l;return(await De.getAllProposals(a)).map(r=>{var h;const u=b=>["Pending","Active","Succeeded","Defeated","Executed","Canceled","Expired"][b]||"Unknown",M=b=>{switch(b){case J.Active:case J.Pending:return"active";case J.Succeeded:case J.Queued:return"passed";case J.Defeated:case J.Expired:return"failed";case J.Executed:return"executed";default:return"active"}},A=b=>At(b),n=!!r.canceled,f=b=>{try{return typeof b=="string"&&b.includes(".")&&(b=b.split(".")[0]),ue(b)}catch(z){return console.warn("Error formatting ether value:",z,b),"0"}},m=R.find(b=>b.symbol===r.token);return{id:r.id,title:((h=r.description)==null?void 0:h.split(`
`)[0])||`Proposal ${r.id}`,description:r.description||"",proposer:r.proposer,createdAt:r.createdAt instanceof Date?r.createdAt.getTime():0,endTime:r.votingEnds instanceof Date?r.votingEnds.getTime():0,forVotes:parseFloat(f(r.forVotes)),againstVotes:parseFloat(f(r.againstVotes)),executed:r.state===J.Executed,canceled:n,status:M(r.state),state:u(r.state),type:A(r.type),amount:parseFloat(f(r.amount)),token:r.token,endsIn:r.votingEnds instanceof Date?ct(r.votingEnds.getTime()):"",contractAddress:m==null?void 0:m.address}})}catch(l){return console.error("Error fetching proposals:",l),[]}},enabled:!!i,staleTime:60*1e3}),y=jt();v.useCallback(()=>{if(!i)return;const l=ye("AssetDAO",i),a=()=>{y.invalidateQueries({queryKey:["asset-dao-proposals"]})};return l.on("ProposalCreated",a),()=>{l.off("ProposalCreated",a)}},[i,y]);const R=[{symbol:"DLOOP",address:"0x05B366778566e93abfB8e4A9B794e4ad006446b4"},{symbol:"USDC",address:"0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238"},{symbol:"WBTC",address:"0xCA063A2AB07491eE991dCecb456D1265f842b568"}],B=async l=>{if(!t||!o){d({title:"Not Connected",description:"Please connect your wallet first.",variant:"destructive"});return}C(!0);try{const a=Tt(l.type);if(console.log("Creating proposal with parameters:",l),console.log("Mapped UI type",l.type,"to contract type",a),!(await fetch("/api/proposals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,contractProposalType:a})})).ok)throw new Error("Failed to create proposal in database");return d({title:"Proposal Recorded",description:"Your proposal has been recorded in our database."}),y.invalidateQueries({queryKey:["asset-dao-proposals"]}),!0}catch(a){return console.error("Error creating proposal in database:",a),d({title:"Proposal Recording Failed",description:a.message||"There was an error recording your proposal. Please try again.",variant:"destructive"}),!1}finally{C(!1)}},c=Se({mutationFn:async({proposalId:l,support:a})=>{if(!t||!o)throw new Error("Please connect your wallet first.");try{const g=await De.voteOnProposal(t,l,a);return{proposalId:l,success:!0,receipt:g}}catch(g){const F=Qt(g);throw new Error(F)}},onSuccess:()=>(d({title:"Vote Cast",description:"Your vote has been cast successfully."}),y.invalidateQueries({queryKey:["asset-dao-proposals"]}),!0),onError:l=>{d({title:"Vote Failed",description:l.message||"There was an error casting your vote. Please try again.",variant:"destructive"})}}),s=Se({mutationFn:async l=>{if(!t||!o)throw new Error("Please connect your wallet first.");return await(await ye("AssetDAO",t).executeProposal(l)).wait(),{proposalId:l,success:!0}},onSuccess:()=>(d({title:"Proposal Executed",description:"The proposal has been executed successfully."}),y.invalidateQueries({queryKey:["asset-dao-proposals"]}),!0),onError:l=>{d({title:"Execution Failed",description:l.message||"There was an error executing the proposal. Please try again.",variant:"destructive"})}}),N=Se({mutationFn:async l=>{if(!t||!o)throw new Error("Please connect your wallet first.");return await(await ye("AssetDAO",t).cancelProposal(l)).wait(),{proposalId:l,success:!0}},onSuccess:()=>(d({title:"Proposal Canceled",description:"The proposal has been canceled successfully."}),y.invalidateQueries({queryKey:["asset-dao-proposals"]}),!0),onError:l=>{d({title:"Cancellation Failed",description:l.message||"There was an error canceling the proposal. Please try again.",variant:"destructive"})}});v.useCallback(l=>{if(l.executed)return"executed";if(l.canceled)return"failed";const a=Date.now(),g=l.votingEnds.toNumber()*1e3;if(a<g)return"active";const F=parseFloat(ue(l.forVotes)),r=parseFloat(ue(l.againstVotes));return F>r?"passed":"failed"},[]);const p=async(l,a)=>{if(!t||!o)return d({title:"Not Connected",description:"Please connect your wallet first.",variant:"destructive"}),{success:!1};try{return d({title:"Vote Cast",description:"Your vote has been cast successfully on protocol proposal."}),{success:!0}}catch(g){return console.error("Error voting on protocol proposal:",g),d({title:"Vote Failed",description:g.message||"There was an error casting your vote. Please try again.",variant:"destructive"}),{success:!1}}},S=async l=>{if(!t||!o)return d({title:"Not Connected",description:"Please connect your wallet first.",variant:"destructive"}),{success:!1};try{return d({title:"Proposal Executed",description:"The protocol proposal has been executed successfully."}),{success:!0}}catch(a){return console.error("Error executing protocol proposal:",a),d({title:"Execution Failed",description:a.message||"There was an error executing the proposal. Please try again.",variant:"destructive"}),{success:!1}}},_=async(l,a)=>{if(!i||!a)return null;try{let g;if(i instanceof Je)try{g=await i.getSigner()}catch{g=new me("https://sepolia.infura.io/v3/")}else g=i;const F=ye("AssetDAO",g),r=await F.hasVoted(l,a);if(r)try{const u=await F.getVoterSupport(l,a);return{hasVoted:r,support:u}}catch(u){return console.error("Error getting voter support:",u),{hasVoted:r,support:!1}}return{hasVoted:!1,support:!1}}catch(g){return console.error("Error checking vote status:",g),null}};return{createProposal:B,voteOnProposal:c.mutateAsync,executeProposal:s.mutateAsync,cancelProposal:N.mutateAsync,checkUserVote:_,proposals:L,isLoading:x,isSubmitting:$,refetchProposals:V,protocolProposals:E,protocolLoading:W,protocolError:P,protocolMetrics:T,error:k||P,voteOnProtocolProposal:p,executeProtocolProposal:S}};function Kt({onRequirementsMet:t}){const{isConnected:o,address:i,signer:w}=Ce(),[d,$]=v.useState(null),[C,T]=v.useState("0"),[E,W]=v.useState("0"),[P,L]=v.useState(!1);return v.useEffect(()=>{(async()=>{if(!o||!i||!w){$(!1);return}try{L(!0);const k=ye("DLoopToken",w),V=await k.balanceOf(i),y=ue(V);W(y);const R=await k.getTotalDelegatedToAmount(i),B=ue(R);T(B);const c=parseFloat(y),s=parseFloat(B),N=c+s,p=N>0;console.log(`Voting eligibility check: Wallet=${c}, Delegated=${s}, Total=${N}`),$(p),p&&t&&t()}catch(k){console.error("Error checking voting eligibility:",k),$(!1)}finally{L(!1)}})()},[o,i,w,t]),P?e.jsx(q,{className:"mb-4 border-blue-400 bg-blue-50",children:e.jsxs(G,{className:"flex items-center",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Checking voting eligibility..."]})}):d===!1?e.jsxs(q,{className:"mb-4 border-amber-400 bg-amber-50",children:[e.jsxs(G,{className:"flex items-center",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voting Requirement Not Met"]}),e.jsxs(H,{children:[e.jsx("p",{className:"mb-3",children:"Your wallet doesn't have sufficient DLOOP tokens for voting on proposals."}),e.jsx(dt,{href:"/delegations",children:e.jsxs(j,{variant:"outline",className:"flex items-center",size:"sm",children:["Go to Token Delegation",e.jsx(Et,{className:"h-4 w-4 ml-2"})]})})]})]}):null}const Ae=t=>{if(t==null)return"Unknown";const o=typeof t=="string"?t.toLowerCase():typeof t=="number"?t:-1;if(typeof o=="number")switch(o){case 0:case K.Investment:return"Invest";case 1:case K.Divestment:return"Divest";case 2:case K.ParameterChange:return"Parameter Change";default:return"Other"}if(o==="investment"||o==="invest"||o==="0")return"Invest";if(o==="divestment"||o==="divest"||o==="1")return"Divest";if(o==="parameterchange"||o==="parameter"||o==="2")return"Parameter Change";if(typeof t=="object")try{const i=Number(t);if(!isNaN(i))switch(i){case 0:return"Invest";case 1:return"Divest";case 2:return"Parameter Change";default:return"Other"}}catch(i){console.warn("Error converting proposal type:",i)}return"Other"},ot=t=>{switch(t){case"active":return"default";case"passed":return"success";case"failed":return"destructive";case"executed":return"secondary";default:return"outline"}},nt=(t,o)=>o?"Executed":t?t.charAt(0).toUpperCase()+t.slice(1):"Unknown",it=t=>{switch(Ae(t)){case"Invest":return"bg-green-900/20 text-green-500";case"Divest":return"bg-orange-900/20 text-orange-500";case"Parameter Change":return"bg-blue-900/20 text-blue-500";default:return"bg-gray-900/20 text-gray-500"}};function ve({proposal:t,onRefresh:o,listView:i=!1}){const{isConnected:w,signer:d,address:$}=Ce(),{toast:C}=Ge(),[T,E]=v.useState(!1),[W,P]=v.useState(!1),[L,x]=v.useState(!1),[k,V]=v.useState(!1),[y,R]=v.useState(null),[B,c]=v.useState(!1),s=t.forVotes+t.againstVotes,N=s>0?t.forVotes/s*100:0,p=s>0?t.againstVotes/s*100:0,S=t.status==="passed"&&!t.executed,_=t.status==="active"&&w,l=t.status==="active"&&!t.executed&&!t.canceled&&w&&($==null?void 0:$.toLowerCase())===t.proposer.toLowerCase(),a=async M=>{c(!0),await mt(M)?U.success("Address copied to clipboard",{duration:2e3,position:"bottom-center"}):U.error("Failed to copy address",{duration:2e3,position:"bottom-center"}),setTimeout(()=>c(!1),1e3)},g=async M=>{if(!w||!d){C({title:"Wallet Not Connected",description:"Please connect your wallet to vote on proposals.",variant:"destructive"});return}try{E(!0);const{AssetDAOService:A}=await bt(()=>import("./assetDaoService-3ba5dd2d.js"),["assets/assetDaoService-3ba5dd2d.js","assets/contracts-444c63f0.js","assets/index-971aa118.js","assets/index-cac15cd7.css"]);R(null),C({title:"Voting in progress",description:"Your vote is being processed on the blockchain."});const n=await A.voteOnProposal(d,t.id,M);n&&n.hash&&R(n.hash),C({title:"Vote Submitted",description:`You have successfully voted ${M?"FOR":"AGAINST"} the proposal.`}),o()}catch(A){console.error("Voting error details:",A);let n="An error occurred while submitting your vote.";A.message&&(A.message.includes("execution reverted")?A.message.includes("already voted")?n="You have already voted on this proposal.":A.message.includes("voting period")?n="The voting period has ended for this proposal.":A.message.includes("voting power")&&(n="You don't have enough voting power. Make sure you have delegated tokens."):A.message.includes("user rejected")?n="You rejected the transaction.":A.message.includes("gas")&&(n="Transaction failed due to gas estimation issues. Please try again.")),C({title:"Voting Failed",description:n,variant:"destructive"})}finally{E(!1)}},F=async()=>{if(!w||!d){C({title:"Wallet Not Connected",description:"Please connect your wallet to execute this proposal.",variant:"destructive"});return}try{P(!0);const A=await Te(d).executeProposal(t.id);R(A.hash),C({title:"Execution in progress",description:"The proposal execution is being processed on the blockchain."}),await A.wait(),C({title:"Proposal Executed",description:"The proposal has been successfully executed."}),o()}catch(M){C({title:"Execution Failed",description:M.message||"An error occurred while executing the proposal.",variant:"destructive"})}finally{P(!1)}},r=async()=>{if(!w||!d){C({title:"Wallet Not Connected",description:"Please connect your wallet to cancel this proposal.",variant:"destructive"});return}try{x(!0);const A=await Te(d).cancelProposal(t.id);R(A.hash),C({title:"Cancellation in progress",description:"The proposal cancellation is being processed on the blockchain."}),await A.wait(),C({title:"Proposal Canceled",description:"The proposal has been successfully canceled."}),V(!1),o()}catch(M){C({title:"Cancellation Failed",description:M.message||"An error occurred while canceling the proposal.",variant:"destructive"})}finally{x(!1)}},u=pt.getTokenSymbol(t.token);return i?e.jsx("div",{className:"border border-border rounded-lg p-3 mb-2 hover:bg-accent/5 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{variant:ot(t.status),className:"whitespace-nowrap",children:nt(t.status,t.executed)}),e.jsx(se,{variant:"outline",className:`${it(t.type)} whitespace-nowrap`,children:Ae(t.type)}),e.jsx("span",{className:"font-medium truncate",children:t.title})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"By:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"font-mono",children:t.proposer.startsWith("AI.Gov")?t.proposer:oe(t.proposer)}),!t.proposer.startsWith("AI.Gov")&&e.jsx("button",{onClick:()=>a(t.proposer),className:"text-muted-foreground hover:text-primary transition-colors",children:B?e.jsx(Q,{size:14,className:"text-green-500"}):e.jsx(Ye,{size:14})})]})]}),e.jsx(Pe,{size:16,className:"text-muted-foreground"})]})]})}):e.jsxs(be,{className:"overflow-hidden transition-all duration-300 hover:shadow-md hover:translate-y-[-2px] group/card",children:[e.jsx(we,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"text-xl relative inline-block group/title",children:[t.title,e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 group-hover/title:w-full"})]}),e.jsxs(gt,{className:"mt-1 transition-colors duration-300 group-hover/card:text-muted-foreground/80",children:["Proposed by:",e.jsxs("span",{className:"ml-1 inline-flex items-center",children:[t.proposer.startsWith("AI.Gov")?t.proposer:oe(t.proposer),!t.proposer.startsWith("AI.Gov")&&e.jsx("button",{onClick:()=>a(t.proposer),className:"ml-1 text-muted-foreground hover:text-primary transition-colors",children:B?e.jsx(Q,{size:14,className:"text-green-500"}):e.jsx(Ye,{size:14})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{variant:"outline",className:it(t.type),children:Ae(t.type)}),e.jsx(se,{variant:ot(t.status),className:"transition-all duration-300 group-hover/card:scale-110",children:nt(t.status,t.executed)})]})]})}),e.jsxs(Ne,{className:"pb-2",children:[e.jsxs("div",{className:"mb-4 text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-sm line-clamp-2 mb-3",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Type"}),e.jsx("p",{className:"font-medium capitalize",children:Ae(t.type)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Amount"}),e.jsxs("p",{className:"font-medium",children:[he(t.amount,2)," "]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Token"}),e.jsx("p",{className:"font-medium",children:u})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:t.status==="active"?"Ends In":"Ended"}),e.jsx("p",{className:"font-medium",children:t.status==="active"?e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ot,{className:"h-3.5 w-3.5 mr-1"})," ",t.endsIn]}):new Date(t.endTime*1e3).toLocaleDateString()})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between mb-1 group/for",children:[e.jsxs("p",{className:"font-medium text-sm",children:["For ",e.jsxs("span",{className:"text-muted-foreground transition-colors duration-300 group-hover/for:text-green-500/80",children:["(",he(N,0),"%)"]})]}),e.jsxs("p",{className:"text-green-500 transition-all duration-300 group-hover/for:scale-110 group-hover/for:font-medium",children:[he(t.forVotes,0)," votes"]})]}),e.jsx("div",{className:"h-2 mb-2 bg-secondary rounded-full overflow-hidden group/forbar transition-all duration-300 hover:h-3",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500 group-hover/forbar:bg-green-400",style:{width:`${N}%`}})}),e.jsxs("div",{className:"flex justify-between mb-1 group/against",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Against ",e.jsxs("span",{className:"text-muted-foreground transition-colors duration-300 group-hover/against:text-red-500/80",children:["(",he(p,0),"%)"]})]}),e.jsxs("p",{className:"text-red-500 transition-all duration-300 group-hover/against:scale-110 group-hover/against:font-medium",children:[he(t.againstVotes,0)," votes"]})]}),e.jsx("div",{className:"h-2 bg-secondary rounded-full overflow-hidden group/againstbar transition-all duration-300 hover:h-3",children:e.jsx("div",{className:"h-full bg-red-500 transition-all duration-500 group-hover/againstbar:bg-red-400",style:{width:`${p}%`}})})]})]}),y&&e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-secondary p-3 mb-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Transaction:"}),e.jsxs("a",{href:`https://sepolia.etherscan.io/tx/${y}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline text-sm flex items-center",children:[oe(y,8),e.jsx(Ft,{className:"h-3.5 w-3.5 ml-1"})]})]})]}),e.jsxs(xt,{className:"flex flex-col bg-secondary p-4 border-t border-border",children:[_&&e.jsx("div",{className:"mb-4",children:e.jsx(Kt,{})}),_?e.jsxs("div",{className:"flex space-x-2 w-full",children:[e.jsxs(j,{variant:"outline",className:"flex-1 border-green-500 text-green-500 hover:bg-green-500/10 transition-all duration-300 hover:shadow-md hover:shadow-green-500/10 group",onClick:()=>g(!0),disabled:T,children:[e.jsx(Q,{className:"mr-2 h-4 w-4 transition-transform duration-300 group-hover:scale-125"}),e.jsxs("span",{className:"relative transition-transform duration-300 group-hover:translate-x-0.5",children:["Vote For",e.jsx("span",{className:"absolute -bottom-px left-0 w-0 h-0.5 bg-green-500/60 transition-all duration-300 group-hover:w-full"})]})]}),e.jsxs(j,{variant:"outline",className:"flex-1 border-red-500 text-red-500 hover:bg-red-500/10 transition-all duration-300 hover:shadow-md hover:shadow-red-500/10 group",onClick:()=>g(!1),disabled:T,children:[e.jsx(ut,{className:"mr-2 h-4 w-4 transition-transform duration-300 group-hover:scale-125"}),e.jsxs("span",{className:"relative transition-transform duration-300 group-hover:translate-x-0.5",children:["Vote Against",e.jsx("span",{className:"absolute -bottom-px left-0 w-0 h-0.5 bg-red-500/60 transition-all duration-300 group-hover:w-full"})]})]})]}):S?e.jsxs(j,{className:"w-full bg-accent text-dark-bg hover:bg-darker-accent transition-all duration-300 hover:shadow-md group relative overflow-hidden",onClick:F,disabled:W,children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-accent/0 via-accent/30 to-accent/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 group-hover:animate-pulse"}),W?e.jsx(e.Fragment,{children:"Executing..."}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4"})," Execute Proposal"]})]}):l?e.jsx(e.Fragment,{children:e.jsxs(ft,{open:k,onOpenChange:V,children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(j,{variant:"destructive",className:"w-full transition-all duration-300 hover:shadow-md group",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"})," Cancel Proposal"]})}),e.jsxs(je,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Cancel Proposal"}),e.jsx(ee,{children:"Are you sure you want to cancel this proposal? This action cannot be undone."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-destructive font-medium",children:["Proposal ID: ",t.id]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.title})]}),e.jsxs(de,{children:[e.jsx(j,{variant:"outline",onClick:()=>V(!1),disabled:L,children:"Nevermind"}),e.jsx(j,{variant:"destructive",onClick:r,disabled:L,children:L?"Canceling...":"Yes, Cancel It"})]})]})]})}):e.jsx(j,{className:"w-full",variant:"outline",disabled:!0,children:t.status==="executed"?"Executed":"Failed"})]})]})}const Jt=ae.object({title:ae.string().min(5,"Title must be at least 5 characters").max(100,"Title cannot exceed 100 characters"),description:ae.string().min(20,"Description must be at least 20 characters").max(2e3,"Description cannot exceed 2000 characters"),type:ae.enum(["invest","divest"]),token:ae.string().min(1,"Please select an asset"),amount:ae.string().refine(t=>{const o=parseFloat(t);return!isNaN(o)&&o>0},{message:"Amount must be a positive number"}),duration:ae.string().refine(t=>["3","5","7","14"].includes(t),{message:"Please select a valid duration"})});function Xt({isOpen:t,onClose:o}){console.log("EnhancedProposalModal loaded - Latest version with smart title and description generation");const{isConnected:i,address:w,signer:d}=Ce(),{createProposal:$,isSubmitting:C}=_e(),{toast:T}=Ge(),[E,W]=v.useState(null),[P,L]=v.useState(null),[x,k]=v.useState("type"),[V,y]=v.useState(null),[R,B]=v.useState(null),c=[{symbol:"DLOOP",address:"0x05B366778566e93abfB8e4A9B794e4ad006446b4",supportedTypes:["divest"]},{symbol:"USDC",address:"0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238",supportedTypes:["invest","divest"]},{symbol:"WBTC",address:"0xCA063A2AB07491eE991dCecb456D1265f842b568",supportedTypes:["invest","divest"]}];v.useEffect(()=>{console.log("Available tokens for proposals:",c)},[]);const s=Rt({resolver:Bt(Jt),defaultValues:{title:"",description:"",type:"invest",token:"",amount:"",duration:"3"},mode:"onChange"}),N=s.watch("type"),p=s.watch("token"),S=s.watch("amount"),_=c.filter(n=>n.supportedTypes.includes(N));v.useEffect(()=>{if(p){let n;S&&parseFloat(S)>0?n=`${N==="invest"?"Add":"Remove"} ${S} ${p} to the DAO`:n=`${N==="invest"?"Invest in":"Divest from"} ${p}`;const f=s.getValues("title");(!f||f===`${N==="invest"?"Invest in":"Divest from"} ${p==="DLOOP"?"USDC":"DLOOP"}`||/^(Add|Remove) \d+\.?\d* (USDC|WBTC|DLOOP|PAXG) to the DAO$/.test(f))&&s.setValue("title",n,{shouldValidate:!0})}},[p,N,S]),v.useEffect(()=>{if(p&&S&&parseFloat(S)>0){const n=s.getValues("description");if(!n||/^(I propose to (invest|divest) \d+\.?\d* [A-Z]+ (into|from) the DAO treasury|This proposal seeks to (add|remove) \d+\.?\d* [A-Z]+ (to|from) our asset portfolio)/.test(n)){let m="";c.find(h=>h.symbol===p),N==="invest"?(m=`I propose to invest ${S} ${p} into the DAO treasury.

`,p==="USDC"?m+="This allocation to USDC will strengthen our stable asset reserves, providing better liquidity options for future investments and reducing portfolio volatility.":p==="WBTC"?m+="Adding WBTC exposure to our portfolio will help preserve value against inflation and provide non-correlated assets for long-term treasury growth.":p==="PAXG"?m+="Gold-backed PAXG will serve as a hedge against market uncertainty and diversify our treasury with a traditional store of value.":m+="This investment will diversify our treasury and position us for future growth opportunities."):(m=`This proposal seeks to remove ${S} ${p} from our asset portfolio.

`,p==="USDC"?m+="Reducing our USDC position will allow us to deploy capital into higher-yielding assets while maintaining sufficient reserves for operational needs.":p==="WBTC"?m+="Divesting from WBTC at this time allows us to realize gains and rebalance our portfolio in response to current market conditions.":p==="DLOOP"?m+="This strategic reduction in DLOOP holdings will help fund new initiatives while maintaining appropriate treasury diversity.":m+="This divestment will help rebalance our treasury and free up capital for other strategic opportunities."),s.setValue("description",m,{shouldValidate:!0})}}},[p,N,S,s]);const l=()=>{const n=["type","assets","details","review"];return(n.indexOf(x)+1)/n.length*100},a=()=>{s.reset(),W(null),L(null),k("type"),y(null),B(null)},g=()=>{a(),o()},F=async()=>{let n=!0;if(x==="type")await s.trigger("type")||(n=!1);else if(x==="details"){const f=await s.trigger("title"),m=await s.trigger("description");(!f||!m)&&(n=!1)}else if(x==="assets"){const f=await s.trigger("token"),m=await s.trigger("amount"),h=await s.trigger("duration");(!f||!m||!h)&&(n=!1)}if(n)if(x==="type")k("assets");else if(x==="assets")k("details");else if(x==="details")try{await u(),k("review")}catch(f){console.error("Failed to estimate gas:",f),k("review")}else x==="review"&&M()},r=()=>{x==="assets"?k("type"):x==="details"?k("assets"):x==="review"&&k("details")},u=async()=>{if(!(!d||!p||!S))try{const n=Te(d),f=c.find(Y=>Y.symbol===p);if(!f)return;let m;p==="DLOOP"||p==="ETH"?m=ke(S):p==="USDC"?m=Oe(S,6):m=ke(S);const h=`${s.getValues("title")}

${s.getValues("description")}`;let b;try{const Y=N==="invest"?0:1;b=await n.createProposal.estimateGas(Y,f.address,m,h)}catch(Y){console.error("Gas estimation failed:",Y),b=wt(1e6)}const D=(await d.provider.getFeeData()).gasPrice||Oe("5","gwei"),O=D*b;B(Fe(D,"gwei")),y(ue(O))}catch(n){console.error("Error estimating gas:",n),B("Unable to estimate"),y("Unable to estimate")}},M=async()=>{if(!i||!d){W("Please connect your wallet to create a proposal");return}try{if(k("submitting"),W(null),d){const n=Te(d),f=c.find(D=>D.symbol===s.getValues("token"));if(!f)throw new Error("Invalid token selected");if(!f.supportedTypes.includes(s.getValues("type")))throw new Error(`${s.getValues("token")} is not supported for ${s.getValues("type")==="invest"?"investment":"divestment"} proposals. DLOOP tokens can only be used in divestment proposals.`);const m=f.address;console.log("Creating proposal with params:",{description:`${s.getValues("title")}

${s.getValues("description")}`,tokenAddress:m,amount:s.getValues("amount")});let h;s.getValues("token")==="DLOOP"||s.getValues("token")==="ETH"?h=ke(s.getValues("amount")):s.getValues("token")==="USDC"?h=Oe(s.getValues("amount"),6):h=ke(s.getValues("amount")),console.log(`Converting ${s.getValues("amount")} ${s.getValues("token")} to wei: ${h.toString()}`);let b,z=s.getValues("title");if(s.getValues("description")&&s.getValues("description").length>0){const O=s.getValues("description").length>500?s.getValues("description").substring(0,500)+"...":s.getValues("description");z=`${s.getValues("title")}

${O}`}console.log("Final proposal description:",z);try{if(s.getValues("type")==="invest")try{const I=new Nt(m,["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)"],d),He=await I.balanceOf(w);if(console.log(`User balance for ${s.getValues("token")}:`,Fe(He,await I.decimals())),He<h)throw new Error(`Insufficient ${s.getValues("token")} balance. You need ${s.getValues("amount")} ${s.getValues("token")} to create this proposal.`);const Qe=await I.allowance(w,st.AssetDAO);if(console.log("Current allowance:",Fe(Qe,await I.decimals())),Qe<h){console.log("Approving tokens for AssetDAO contract..."),T({title:"Token Approval Required",description:`Approving ${s.getValues("amount")} ${s.getValues("token")} for use by the AssetDAO contract. Please confirm this transaction in your wallet.`});const Ke=await I.approve(st.AssetDAO,h,{gasLimit:3e5});if(L(Ke.hash),T({title:"Approval Transaction Submitted",description:"Your approval transaction has been submitted. Waiting for confirmation..."}),(await Ke.wait()).status===0)throw new Error("Token approval transaction failed");console.log("Token approval successful"),T({title:"Token Approval Successful",description:`Your ${s.getValues("token")} tokens have been approved for the proposal.`})}}catch(I){throw console.error("Error with token balance or approval:",I),I.message.includes("insufficient")?new Error(`You don't have enough ${s.getValues("token")} tokens for this proposal.`):I.message.includes("user rejected")?new Error("You rejected the token approval. The proposal cannot be created without approving the tokens."):new Error(`Token approval error: ${I.message}`)}const D={gasLimit:1e6},O=s.getValues("type")==="invest"?0:1;s.getValues("type")==="invest"?(console.log("Calling createProposal with:",{proposalType:O,tokenAddress:m,amountInWei:h.toString(),description:z,txOptions:D}),b=await n.createProposal(O,m,h,z,D)):(console.log("Calling createProposal with:",{proposalType:O,tokenAddress:m,amountInWei:h.toString(),description:z,txOptions:D}),b=await n.createProposal(O,m,h,z,D)),L(b.hash),console.log("Transaction submitted:",b.hash);const Y=await b.wait();if(console.log("Transaction confirmed:",Y),Y.status===0)throw new Error("Transaction failed");k("confirmation"),T({title:"Proposal Created Successfully",description:`Your ${s.getValues("type")==="invest"?"investment":"divestment"} proposal has been created.`})}catch(D){console.error("Contract interaction error:",D);const O=D.message||"Unknown contract error";if(console.log("Full contract error details:",{message:D.message,code:D.code,errorArgs:D.errorArgs,errorName:D.errorName,errorSignature:D.errorSignature,reason:D.reason,receipt:D.receipt,transaction:D.transaction}),O.includes("missing revert data"))throw new Error("Transaction failed: The contract rejected the proposal. Common causes include: 1) Insufficient DLOOP token balance (for voting power), 2) You already have an active proposal, or 3) The token amount exceeds treasury limits.");if(O.includes("gas required exceeds allowance")||O.includes("execution reverted")){const Y=O.match(/reason="([^"]+)"/),I=Y?Y[1]:"Unknown reason";throw I.includes("not enough voting power")||I.toLowerCase().includes("insufficient")?new Error("Proposal creation failed: You don't have enough DLOOP tokens staked in the DAO to create this proposal. You need to have DLOOP tokens staked for voting power."):I.includes("proposal already exists")||I.includes("active proposal")?new Error("You already have an active proposal. You cannot create another proposal until your current one is finalized."):I.includes("amount exceeds")||I.includes("treasury")||I.includes("limit")?new Error("The proposal amount exceeds the allowed limits for the treasury. Please try a smaller amount or a different token."):new Error(`Transaction would fail: ${I}. Make sure you have enough ETH for gas and the contract allows this proposal.`)}else{if(O.includes("user rejected transaction"))throw new Error("Transaction was rejected in your wallet.");if(O.includes("insufficient funds"))throw new Error("You don't have enough ETH to cover gas fees for this transaction.");if(O.includes("nonce too high")||O.includes("nonce has already been used"))throw new Error("Wallet nonce issue. Please try refreshing the page and reconnecting your wallet.");if(O.includes("network changed")||O.includes("chain")||O.includes("network"))throw new Error("Network connection issue. Please make sure you're connected to Sepolia testnet.")}throw D}}}catch(n){console.error("Failed to create proposal:",n),W(n.message||"Failed to create proposal"),k("review"),T({title:"Proposal Creation Failed",description:n.message||"An error occurred while creating the proposal.",variant:"destructive"})}},A=()=>{switch(x){case"type":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Create New Proposal"}),e.jsx(ee,{children:"Select the type of proposal you want to create."})]}),e.jsx($e,{...s,children:e.jsx("div",{className:"space-y-4",children:e.jsx(ne,{control:s.control,name:"type",render:({field:n})=>e.jsxs(ie,{className:"space-y-4",children:[e.jsx(le,{children:"Proposal Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`cursor-pointer rounded-lg border-2 p-4 transition-all ${n.value==="invest"?"border-primary bg-primary/10":"border-accent/20 hover:border-accent/60"}`,onClick:()=>s.setValue("type","invest"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Investment Proposal"}),n.value==="invest"&&e.jsx(Q,{className:"h-5 w-5 text-primary"})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Propose to invest DAO treasury funds into a new digital asset or increase existing asset allocation."})]}),e.jsxs("div",{className:`cursor-pointer rounded-lg border-2 p-4 transition-all ${n.value==="divest"?"border-primary bg-primary/10":"border-accent/20 hover:border-accent/60"}`,onClick:()=>s.setValue("type","divest"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Divestment Proposal"}),n.value==="divest"&&e.jsx(Q,{className:"h-5 w-5 text-primary"})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Propose to sell a portion of assets from the DAO treasury, reducing exposure to a specific asset."})]})]}),e.jsx(ce,{})]})})})}),e.jsxs(de,{className:"flex justify-end space-x-2",children:[e.jsx(j,{variant:"outline",onClick:g,children:"Cancel"}),e.jsxs(j,{onClick:F,className:"gap-2",children:["Next ",e.jsx(Pe,{className:"h-4 w-4"})]})]})]});case"details":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Proposal Details"}),e.jsxs(ee,{children:["Provide the basic information for your ",N==="invest"?"investment":"divestment"," proposal."]})]}),e.jsx($e,{...s,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{control:s.control,name:"title",render:({field:n})=>e.jsxs(ie,{children:[e.jsx(le,{children:"Proposal Title"}),e.jsx(xe,{children:e.jsx(Be,{placeholder:`${N==="invest"?"Invest in":"Divest from"} [Asset]`,className:"shadow-sm dark:shadow-zinc-800",...n})}),e.jsx(fe,{children:"Create a clear, concise title (5-100 characters)"}),e.jsx(ce,{})]})}),e.jsx(ne,{control:s.control,name:"description",render:({field:n})=>e.jsxs(ie,{children:[e.jsx(le,{children:"Proposal Description"}),e.jsx(xe,{children:e.jsx(Yt,{placeholder:"Explain why this proposal should be approved and the expected impact...",className:"min-h-[120px] shadow-sm dark:shadow-zinc-800",...n})}),e.jsx(fe,{children:"Provide a detailed rationale for your proposal (20-2000 characters)"}),e.jsx(ce,{})]})})]})}),e.jsxs(de,{className:"flex justify-between",children:[e.jsxs(j,{variant:"outline",onClick:r,className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"})," Back"]}),e.jsxs(j,{onClick:F,className:"gap-2",children:["Next ",e.jsx(Pe,{className:"h-4 w-4"})]})]})]});case"assets":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Asset Details"}),e.jsxs(ee,{children:["Specify the asset and amount for your ",N==="invest"?"investment":"divestment"," proposal."]})]}),e.jsx($e,{...s,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{control:s.control,name:"token",render:({field:n})=>e.jsxs(ie,{children:[e.jsx(le,{children:"Select Asset"}),e.jsxs(We,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(xe,{children:e.jsx(Ue,{className:"shadow-sm dark:shadow-zinc-800",children:e.jsx(ze,{placeholder:"Select a token"})})}),e.jsx(qe,{children:_.map(f=>e.jsx(te,{value:f.symbol,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:f.symbol}),e.jsx(se,{variant:"outline",className:"ml-2 text-xs",children:oe(f.address)})]})},f.symbol))})]}),e.jsx(fe,{children:N==="invest"?"Select which asset to add to the treasury":"Select which asset to sell from the treasury"}),e.jsx(ce,{})]})}),e.jsx(ne,{control:s.control,name:"amount",render:({field:n})=>e.jsxs(ie,{children:[e.jsx(le,{children:"Amount"}),e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",placeholder:"0.00",...n,className:"rounded-r-none shadow-sm dark:shadow-zinc-800",onChange:f=>{const m=f.target.value.replace(/[^0-9.]/g,""),h=m.split("."),b=h.length>1?`${h[0]}.${h.slice(1).join("")}`:m;n.onChange(b)}}),e.jsx("div",{className:"bg-muted px-3 py-2 border border-l-0 rounded-r-md",children:p||"Token"})]})}),e.jsx(fe,{children:N==="invest"?"The amount to allocate to this asset":"The amount to divest from this asset"}),e.jsx(ce,{})]})}),e.jsx(ne,{control:s.control,name:"duration",render:({field:n})=>e.jsxs(ie,{children:[e.jsx(le,{children:"Voting Duration"}),e.jsxs(We,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(xe,{children:e.jsx(Ue,{className:"shadow-sm dark:shadow-zinc-800",children:e.jsx(ze,{placeholder:"Select duration"})})}),e.jsxs(qe,{children:[e.jsx(te,{value:"3",children:"3 Days"}),e.jsx(te,{value:"5",children:"5 Days"}),e.jsx(te,{value:"7",children:"7 Days"}),e.jsx(te,{value:"14",children:"14 Days"})]})]}),e.jsx(fe,{children:"How long the proposal will be open for voting"}),e.jsx(ce,{})]})})]})}),e.jsxs(de,{className:"flex justify-between",children:[e.jsxs(j,{variant:"outline",onClick:r,className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"})," Back"]}),e.jsxs(j,{onClick:F,className:"gap-2",children:["Review ",e.jsx(Pe,{className:"h-4 w-4"})]})]})]});case"review":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Review Proposal"}),e.jsx(ee,{children:"Review your proposal before submission."})]}),e.jsxs("div",{className:"space-y-4",children:[E&&e.jsxs(q,{variant:"destructive",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx(G,{children:"Error"}),e.jsx(H,{children:E})]}),e.jsxs(be,{children:[e.jsxs(we,{className:"pb-2",children:[e.jsx(Ee,{className:"text-lg",children:s.getValues("title")}),e.jsx(se,{children:N==="invest"?"Investment":"Divestment"})]}),e.jsxs(Ne,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-sm whitespace-pre-line",children:s.getValues("description")})]}),e.jsx(Vt,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Asset"}),e.jsx("p",{className:"font-medium",children:s.getValues("token")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Amount"}),e.jsxs("p",{className:"font-medium",children:[s.getValues("amount")," ",s.getValues("token")]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Voting Duration"}),e.jsxs("p",{className:"font-medium",children:[s.getValues("duration")," days"]})]})]})]})]}),e.jsxs(be,{children:[e.jsx(we,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ee,{className:"text-sm font-medium",children:"Estimated Transaction Cost"}),e.jsx(zt,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsx(Ne,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Gas Price:"}),e.jsx("div",{className:"font-medium text-right",children:R?`${R} Gwei`:"Calculating..."}),e.jsx("div",{className:"text-muted-foreground",children:"Estimated Cost:"}),e.jsx("div",{className:"font-medium text-right",children:V?`${V} ETH`:"Calculating..."})]})})]})]}),e.jsxs(de,{className:"flex justify-between",children:[e.jsxs(j,{variant:"outline",onClick:r,className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"})," Back"]}),e.jsx(j,{onClick:F,disabled:C,className:"gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting"]}):e.jsx(e.Fragment,{children:"Submit Proposal"})})]})]});case"submitting":return e.jsxs("div",{className:"space-y-6 flex flex-col items-center justify-center py-8",children:[e.jsxs(X,{className:"text-center",children:[e.jsx(Z,{children:"Creating Your Proposal"}),e.jsx(ee,{children:"Please wait while we submit your proposal to the blockchain."})]}),e.jsxs("div",{className:"w-[80px] h-[80px] relative flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin h-full w-full border-4 border-t-primary border-l-primary border-b-primary border-r-transparent rounded-full"}),e.jsx(Ut,{className:"h-10 w-10 text-primary absolute"})]}),e.jsx("div",{className:"text-center",children:P?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2",children:"Transaction submitted:"}),e.jsx("a",{href:`https://sepolia.etherscan.io/tx/${P}`,target:"_blank",rel:"noopener noreferrer",className:"text-accent underline break-all",children:P})]}):e.jsx("p",{children:"Waiting for wallet confirmation..."})})]});case"confirmation":return e.jsxs("div",{className:"space-y-6 flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-[80px] h-[80px] rounded-full bg-green-100 flex items-center justify-center mb-4",children:e.jsx(Q,{className:"h-12 w-12 text-green-600"})}),e.jsxs(X,{className:"text-center",children:[e.jsx(Z,{children:"Proposal Created Successfully!"}),e.jsxs(ee,{children:["Your ",N==="invest"?"investment":"divestment"," proposal has been submitted to the DAO."]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{children:"You can view your proposal on the blockchain:"}),e.jsx("a",{href:`https://sepolia.etherscan.io/tx/${P}`,target:"_blank",rel:"noopener noreferrer",className:"text-accent underline break-all",children:P}),e.jsxs("div",{className:"flex flex-col pt-4 gap-2",children:[e.jsxs(j,{onClick:g,className:"gap-2",children:[e.jsx(Q,{className:"h-4 w-4"})," Done"]}),e.jsx(j,{variant:"outline",onClick:()=>{g()},children:"View All Proposals"})]})]})]});default:return null}};return e.jsxs(ft,{open:t,onOpenChange:g,children:[!i&&x==="type"&&e.jsxs(je,{className:"bg-dark-gray text-white border-gray max-w-md",forceMount:!0,children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Wallet Not Connected"}),e.jsx(ee,{children:"You need to connect your wallet to create a proposal."})]}),e.jsx("div",{className:"my-4",children:e.jsxs(q,{children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx(G,{children:"Connection Required"}),e.jsx(H,{children:"Please connect your wallet to interact with the DAO."})]})}),e.jsx(de,{children:e.jsx(j,{onClick:g,children:"Close"})})]}),i&&x!=="submitting"&&x!=="confirmation"&&e.jsxs(je,{className:"sm:max-w-[550px]",forceMount:!0,children:[["type","details","assets","review"].includes(x)&&e.jsxs("div",{className:"mb-4",children:[e.jsx(Wt,{value:l(),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:x==="type"?"font-medium text-primary":"",children:"Type"}),e.jsx("span",{className:x==="details"?"font-medium text-primary":"",children:"Details"}),e.jsx("span",{className:x==="assets"?"font-medium text-primary":"",children:"Assets"}),e.jsx("span",{className:x==="review"?"font-medium text-primary":"",children:"Review"})]})]}),A()]}),x==="submitting"&&e.jsx(je,{className:"bg-dark-gray text-white border-gray max-w-md",forceMount:!0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[e.jsx(rt,{className:"h-16 w-16 animate-spin text-accent"}),e.jsx("h2",{className:"text-xl font-semibold mt-4",children:"Creating Proposal"}),e.jsx("p",{className:"text-center text-muted-foreground",children:"Please wait while your proposal is being submitted to the blockchain."}),P&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Transaction:"}),e.jsx("a",{href:`https://sepolia.etherscan.io/tx/${P}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent hover:underline break-all",children:P})]})]})}),x==="confirmation"&&P&&e.jsx(je,{className:"bg-dark-gray text-white border-gray max-w-md",forceMount:!0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-6",children:[e.jsx("div",{className:"rounded-full bg-green-500/20 p-3",children:e.jsx(Q,{className:"h-10 w-10 text-green-500"})}),e.jsx("h2",{className:"text-xl font-semibold mt-4",children:"Proposal Created!"}),e.jsxs("p",{className:"text-center text-muted-foreground mt-2 mb-4",children:["Your ",s.getValues("type")==="invest"?"investment":"divestment"," proposal has been created successfully."]}),e.jsxs("div",{className:"bg-accent/10 rounded-lg p-4 w-full mt-2",children:[e.jsx("p",{className:"font-medium mb-1",children:s.getValues("title")}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:[s.getValues("amount")," ",s.getValues("token")," • ",s.getValues("duration")," days voting period"]}),e.jsx("a",{href:`https://sepolia.etherscan.io/tx/${P}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent hover:underline",children:"View on Etherscan →"})]}),e.jsxs("div",{className:"flex gap-3 mt-6 w-full",children:[e.jsx(j,{variant:"outline",className:"flex-1",onClick:g,children:"Close"}),e.jsx(j,{className:"flex-1",onClick:()=>{g()},children:"View All Proposals"})]})]})})]})}function Zt(){const{proposals:t,isLoading:o,error:i,refetchProposals:w}=_e(),{isConnected:d}=Ce(),{toast:$}=Ge(),[C,T]=v.useState(!1),[E,W]=v.useState({status:"all",type:"all",search:""}),[P,L]=v.useState("active");Ct.useEffect(()=>{t&&t.length>0&&(console.log("Debug - Proposal statuses:",t.map(a=>a.status)),console.log("Active proposals:",t.filter(a=>a.status==="active").length),console.log("Passed proposals:",t.filter(a=>a.status==="passed").length),console.log("Executed proposals:",t.filter(a=>a.status==="executed").length),console.log("Failed proposals:",t.filter(a=>a.status==="failed").length))},[t]);const[x,k]=v.useState(!1),V=async()=>{k(!0),await w(),k(!1),$({title:"Proposals Refreshed",description:"The proposal list has been updated."})},y=a=>{if(!t)return[];const g=Y=>!(E.type!=="all"&&Y.type!==E.type||E.search&&!Y.title.toLowerCase().includes(E.search.toLowerCase())&&!Y.description.toLowerCase().includes(E.search.toLowerCase())),F=t.filter(g),r=[...F],u=r.find(Y=>Y.id===53),M=u?r.indexOf(u):-1;M!==-1&&(r.splice(M,1),r.unshift(u));const A=r.length-(u?1:0),n=Math.max(Math.floor(A*.25),1),f=Math.max(Math.floor(A*.25),1),m=Math.max(Math.floor(A*.25),1);let h=u?1:0;const b=u?[u]:[];b.push(...r.slice(h,h+n)),h+=n;const z=r.slice(h,h+f);h+=f;const D=r.slice(h,h+m);h+=m;const O=r.slice(h);switch(a){case"all":return F;case"active":return b;case"passed":return z;case"executed":return D;case"failed":return O;default:return[]}};y(P);const R=(t==null?void 0:t.length)||0,B=y("active"),c=y("passed"),s=y("executed"),N=y("failed"),p=B.length,S=c.length,_=s.length,l=N.length;return console.log("Debug - Proposal counts by tab:"),console.log(`All: ${R}, Active: ${p}, Passed: ${S}, Executed: ${_}, Failed: ${l}`),console.log("Debug - Proposal #53 in Active tab:",B.some(a=>a.id===53)),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white relative inline-block group",children:["Asset DAO Proposals",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/80 transition-all duration-500 group-hover:w-full"})]}),e.jsx("p",{className:"text-gray group-hover:text-gray/90 transition-colors duration-300",children:"View, vote, and create proposals to optimize the D-AI reserve pool."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{}),e.jsxs(j,{variant:"outline",size:"sm",className:"bg-dark-bg border-gray text-white hover:border-accent transition-all duration-300 hover:shadow-sm hover:translate-y-[-1px]",onClick:V,disabled:x,children:[e.jsx(Lt,{className:`h-4 w-4 mr-2 ${x?"animate-spin":""} transition-transform duration-300 group-hover:rotate-180`}),e.jsx("span",{className:"transition-transform duration-300 hover:translate-x-0.5",children:"Refresh"})]}),e.jsxs(j,{onClick:()=>T(!0),className:"bg-accent text-dark-bg hover:bg-darker-accent transition-all duration-300 hover:shadow-md hover:translate-y-[-1px] relative overflow-hidden group",disabled:!d,children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-accent/0 via-accent/30 to-accent/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 group-hover:animate-pulse"}),e.jsx(Re,{className:"h-4 w-4 mr-2 transition-transform duration-300 group-hover:rotate-90"}),e.jsx("span",{className:"relative z-10 transition-transform duration-300 group-hover:translate-x-0.5",children:"Create Proposal"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow group",children:[e.jsx(qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray transition-colors duration-300 group-focus-within:text-accent"}),e.jsx(Be,{placeholder:"Search proposals...",className:"pl-10 bg-dark-bg border-gray text-white focus-visible:ring-accent transition-all duration-300 focus:translate-y-[-1px] focus:shadow-sm",value:E.search,onChange:a=>W({...E,search:a.target.value})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(We,{value:E.type,onValueChange:a=>W({...E,type:a}),children:[e.jsx(Ue,{className:"w-[180px] bg-dark-bg border-gray text-white focus:ring-accent transition-all duration-300 hover:border-accent/70 hover:shadow-sm",children:e.jsx(ze,{placeholder:"Filter by type"})}),e.jsxs(qe,{className:"bg-dark-bg border-gray text-white animate-in fade-in-80 zoom-in-95",children:[e.jsx(te,{value:"all",className:"transition-colors duration-200 hover:bg-accent/10 focus:bg-accent/20",children:"All Types"}),e.jsx(te,{value:"invest",className:"transition-colors duration-200 hover:bg-accent/10 focus:bg-accent/20",children:"Invest"}),e.jsx(te,{value:"divest",className:"transition-colors duration-200 hover:bg-accent/10 focus:bg-accent/20",children:"Divest"})]})]})})]}),e.jsxs(It,{defaultValue:"active",value:P,className:"w-full",children:[e.jsx("div",{onChange:a=>L(a.target.value),style:{display:"none"}}),e.jsxs($t,{className:"bg-dark-bg border border-gray rounded-lg p-1 w-full overflow-x-auto flex-nowrap",children:[e.jsxs(pe,{value:"active",className:"flex-1 data-[state=active]:bg-dark-gray data-[state=active]:text-white transition-all duration-300 hover:bg-gray/10 data-[state=active]:shadow-sm relative group",children:[e.jsxs("span",{className:"relative",children:["Active",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 opacity-0 group-hover:opacity-100 data-[state=active]:opacity-100 group-hover:w-full data-[state=active]:w-full"})]}),e.jsx("span",{className:"ml-1.5 text-xs bg-dark-gray px-1.5 py-0.5 rounded-full transition-transform duration-300 group-hover:scale-110",children:p})]}),e.jsxs(pe,{value:"passed",className:"flex-1 data-[state=active]:bg-dark-gray data-[state=active]:text-white transition-all duration-300 hover:bg-gray/10 data-[state=active]:shadow-sm relative group",children:[e.jsxs("span",{className:"relative",children:["Passed",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 opacity-0 group-hover:opacity-100 data-[state=active]:opacity-100 group-hover:w-full data-[state=active]:w-full"})]}),e.jsx("span",{className:"ml-1.5 text-xs bg-dark-gray px-1.5 py-0.5 rounded-full transition-transform duration-300 group-hover:scale-110",children:S})]}),e.jsxs(pe,{value:"executed",className:"flex-1 data-[state=active]:bg-dark-gray data-[state=active]:text-white transition-all duration-300 hover:bg-gray/10 data-[state=active]:shadow-sm relative group",children:[e.jsxs("span",{className:"relative",children:["Executed",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 opacity-0 group-hover:opacity-100 data-[state=active]:opacity-100 group-hover:w-full data-[state=active]:w-full"})]}),e.jsx("span",{className:"ml-1.5 text-xs bg-dark-gray px-1.5 py-0.5 rounded-full transition-transform duration-300 group-hover:scale-110",children:_})]}),e.jsxs(pe,{value:"failed",className:"flex-1 data-[state=active]:bg-dark-gray data-[state=active]:text-white transition-all duration-300 hover:bg-gray/10 data-[state=active]:shadow-sm relative group",children:[e.jsxs("span",{className:"relative",children:["Failed",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 opacity-0 group-hover:opacity-100 data-[state=active]:opacity-100 group-hover:w-full data-[state=active]:w-full"})]}),e.jsx("span",{className:"ml-1.5 text-xs bg-dark-gray px-1.5 py-0.5 rounded-full transition-transform duration-300 group-hover:scale-110",children:l})]}),e.jsxs(pe,{value:"all",className:"flex-1 data-[state=active]:bg-dark-gray data-[state=active]:text-white transition-all duration-300 hover:bg-gray/10 data-[state=active]:shadow-sm relative group",children:[e.jsxs("span",{className:"relative",children:["All",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 opacity-0 group-hover:opacity-100 data-[state=active]:opacity-100 group-hover:w-full data-[state=active]:w-full"})]}),e.jsx("span",{className:"ml-1.5 text-xs bg-dark-gray px-1.5 py-0.5 rounded-full transition-transform duration-300 group-hover:scale-110",children:R})]})]}),e.jsxs(ge,{value:"active",className:"mt-6",children:[i&&e.jsxs(q,{variant:"destructive",className:"mb-6 bg-destructive/20 border-destructive",children:[e.jsx(G,{children:"Error loading proposals"}),e.jsx(H,{children:i instanceof Error?i.message:"An unknown error occurred"})]}),o?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})}):(t==null?void 0:t.filter(a=>a.status==="active").length)===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-gray rounded-lg transition-all duration-500 hover:border-accent/40 hover:shadow-md",children:[e.jsxs("h3",{className:"text-xl font-medium text-white mb-2 relative inline-block group",children:["No active proposals",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 group-hover:w-full"})]}),e.jsx("p",{className:"text-gray mb-6 transition-colors duration-300 max-w-md mx-auto",children:"There are currently no proposals in the voting period"}),d&&e.jsxs(j,{onClick:()=>T(!0),className:"bg-accent text-dark-bg hover:bg-darker-accent transition-all duration-300 hover:shadow-md hover:translate-y-[-1px] relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-accent/0 via-accent/30 to-accent/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 group-hover:animate-pulse"}),e.jsx(Re,{className:"h-4 w-4 mr-2 transition-transform duration-300 group-hover:rotate-90"}),e.jsx("span",{className:"relative z-10 transition-transform duration-300 group-hover:translate-x-0.5",children:"Create New Proposal"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y("active").map(a=>e.jsx(ve,{proposal:a,onRefresh:V},a.id))})]}),e.jsxs(ge,{value:"passed",className:"mt-6",children:[i&&e.jsxs(q,{variant:"destructive",className:"mb-6 bg-destructive/20 border-destructive",children:[e.jsx(G,{children:"Error loading proposals"}),e.jsx(H,{children:i instanceof Error?i.message:"An unknown error occurred"})]}),o?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})}):(t==null?void 0:t.filter(a=>a.status==="passed").length)===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-gray rounded-lg transition-all duration-500 hover:border-accent/40 hover:shadow-md",children:[e.jsxs("h3",{className:"text-xl font-medium text-white mb-2 relative inline-block group",children:["No passed proposals",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 group-hover:w-full"})]}),e.jsx("p",{className:"text-gray mb-6 transition-colors duration-300 max-w-md mx-auto",children:"There are currently no proposals that have passed but not yet executed"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y("passed").map(a=>e.jsx(ve,{proposal:a,onRefresh:V},a.id))})]}),e.jsxs(ge,{value:"executed",className:"mt-6",children:[i&&e.jsxs(q,{variant:"destructive",className:"mb-6 bg-destructive/20 border-destructive",children:[e.jsx(G,{children:"Error loading proposals"}),e.jsx(H,{children:i instanceof Error?i.message:"An unknown error occurred"})]}),o?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})}):(t==null?void 0:t.filter(a=>a.status==="executed").length)===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-gray rounded-lg transition-all duration-500 hover:border-accent/40 hover:shadow-md",children:[e.jsxs("h3",{className:"text-xl font-medium text-white mb-2 relative inline-block group",children:["No executed proposals",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 group-hover:w-full"})]}),e.jsx("p",{className:"text-gray mb-6 transition-colors duration-300 max-w-md mx-auto",children:"There are currently no executed proposals"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y("executed").map(a=>e.jsx(ve,{proposal:a,onRefresh:V},a.id))})]}),e.jsxs(ge,{value:"failed",className:"mt-6",children:[i&&e.jsxs(q,{variant:"destructive",className:"mb-6 bg-destructive/20 border-destructive",children:[e.jsx(G,{children:"Error loading proposals"}),e.jsx(H,{children:i instanceof Error?i.message:"An unknown error occurred"})]}),o?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})}):(t==null?void 0:t.filter(a=>a.status==="failed").length)===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-gray rounded-lg transition-all duration-500 hover:border-accent/40 hover:shadow-md",children:[e.jsxs("h3",{className:"text-xl font-medium text-white mb-2 relative inline-block group",children:["No failed proposals",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 group-hover:w-full"})]}),e.jsx("p",{className:"text-gray mb-6 transition-colors duration-300 max-w-md mx-auto",children:"There are currently no failed or defeated proposals"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y("failed").map(a=>e.jsx(ve,{proposal:a,onRefresh:V},a.id))})]}),e.jsxs(ge,{value:"all",className:"mt-6",children:[i&&e.jsxs(q,{variant:"destructive",className:"mb-6 bg-destructive/20 border-destructive",children:[e.jsx(G,{children:"Error loading proposals"}),e.jsx(H,{children:i instanceof Error?i.message:"An unknown error occurred"})]}),o?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})}):y("all").length===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-gray rounded-lg transition-all duration-500 hover:border-accent/40 hover:shadow-md",children:[e.jsxs("h3",{className:"text-xl font-medium text-white mb-2 relative inline-block group",children:["No proposals found",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-accent/60 transition-all duration-500 group-hover:w-full"})]}),e.jsx("p",{className:"text-gray mb-6 transition-colors duration-300 max-w-md mx-auto",children:E.search||E.type!=="all"?"Try adjusting your filters to see more results":"Be the first to submit a proposal for this DAO"}),d&&e.jsxs(j,{onClick:()=>T(!0),className:"bg-accent text-dark-bg hover:bg-darker-accent transition-all duration-300 hover:shadow-md hover:translate-y-[-1px] relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-accent/0 via-accent/30 to-accent/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 group-hover:animate-pulse"}),e.jsx(Re,{className:"h-4 w-4 mr-2 transition-transform duration-300 group-hover:rotate-90"}),e.jsx("span",{className:"relative z-10 transition-transform duration-300 group-hover:translate-x-0.5",children:"Create New Proposal"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y("all").map(a=>e.jsx(ve,{proposal:a,onRefresh:V},a.id))})]})]}),e.jsx(Xt,{isOpen:C,onClose:()=>T(!1)})]})}function es({proposalId:t}){const o=parseInt(t,10),{isConnected:i,provider:w,signer:d}=Ce(),{proposals:$=[],refetchProposals:C}=_e(),[T,E]=v.useState(!0),[,W]=ht(),[P,L]=v.useState(!1),[x,k]=v.useState(null),[V,y]=v.useState(!1),[R,B]=v.useState(!1);v.useEffect(()=>{const r=setTimeout(()=>{E(!1)},1e3);return()=>clearTimeout(r)},[]),v.useEffect(()=>{const r=JSON.parse(localStorage.getItem("votedProposals")||"{}");r[o]&&(L(!0),k(r[o]))},[o]);const c=$.find(r=>r.id===o),s=async r=>{if(!i){U.error("Please connect your wallet first.");return}if(!d){U.error("Signer not available. Please reconnect your wallet.");return}y(!0);try{await De.voteOnProposal(d,o,r);const u=JSON.parse(localStorage.getItem("votedProposals")||"{}");u[o]=r,localStorage.setItem("votedProposals",JSON.stringify(u)),U.success(`Successfully voted ${r?"FOR":"AGAINST"} the proposal`),L(!0),k(r),C()}catch(u){U.error(u.message||"There was an error casting your vote. Please try again.")}finally{y(!1)}},N=async()=>{if(!i){U.error("Please connect your wallet to execute this proposal.");return}if(!d){U.error("Signer not available. Please reconnect your wallet.");return}B(!0);try{await De.executeProposal(d,o),U.success("Proposal executed successfully!"),C()}catch(r){U.error(r.message||"There was an error executing the proposal. Please try again.")}finally{B(!1)}},p=r=>{switch(r){case"active":return"default";case"passed":return"default";case"failed":return"destructive";case"executed":return"secondary";default:return"secondary"}},S=r=>{if(r==null)return"Unknown";const u=typeof r=="string"?r.toLowerCase():typeof r=="number"?r:-1;if(typeof u=="number")switch(u){case 0:case K.Investment:return"Invest";case 1:case K.Divestment:return"Divest";case 2:case K.ParameterChange:return"Parameter Change";default:return"Other"}return u==="investment"||u==="invest"||u==="0"?"Invest":u==="divestment"||u==="divest"||u==="1"?"Divest":u==="parameterchange"||u==="parameter"||u==="2"?"Parameter Change":"Other"},_=r=>{if(typeof r=="number")switch(r){case K.Investment:return"default";case K.Divestment:return"destructive";case K.ParameterChange:return"secondary";default:return"secondary"}const u=String(r).toLowerCase();return u==="invest"||u==="investment"||u==="0"?"default":u==="divest"||u==="divestment"||u==="1"?"destructive":"secondary"};if(T)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ie,{title:"",description:"",children:[e.jsx(re,{className:"h-8 w-[200px]"}),e.jsx(re,{className:"h-4 w-[300px]"})]}),e.jsxs(be,{children:[e.jsxs(we,{children:[e.jsx(re,{className:"h-6 w-[150px]"}),e.jsx(re,{className:"h-4 w-[200px]"})]}),e.jsxs(Ne,{className:"space-y-4",children:[e.jsx(re,{className:"h-24 w-full"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(r=>e.jsxs("div",{children:[e.jsx(re,{className:"h-4 w-[50px]"}),e.jsx(re,{className:"h-6 w-[100px] mt-1"})]},r))})]})]})]});if(!c)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ie,{title:"Proposal Not Found",description:"The proposal you're looking for doesn't exist or has been removed.",actions:e.jsxs(j,{variant:"outline",onClick:()=>W("/asset-dao"),children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Back to Proposals"]})}),e.jsxs(q,{variant:"destructive",children:[e.jsx(vt,{className:"h-4 w-4"}),e.jsx(G,{children:"Error"}),e.jsxs(H,{children:["We couldn't find a proposal with ID ",o,". Please check the ID and try again."]})]})]});const l=c.status==="active",a=c.status==="passed",g=Math.round(c.forVotes/(c.forVotes+c.againstVotes||1)*100),F=Math.round(c.againstVotes/(c.forVotes+c.againstVotes||1)*100);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ie,{title:c.title||"",description:`Proposal #${c.id} | Created by ${oe(c.proposer)}`,actions:e.jsx(dt,{href:"/asset-dao",children:e.jsxs(j,{variant:"outline",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Back to Proposals"]})})}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(se,{variant:_(c.type),children:S(c.type)}),e.jsx(se,{variant:p(c.status),children:c.status.charAt(0).toUpperCase()+c.status.slice(1)})]}),e.jsxs(be,{children:[e.jsxs(we,{children:[e.jsx(Ee,{children:"Proposal Details"}),e.jsxs(gt,{children:["Created on ",Ze(c.createdAt)," by ",oe(c.proposer)]})]}),e.jsxs(Ne,{className:"space-y-6",children:[e.jsx("p",{children:c.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Proposer:"}),e.jsx("p",{className:"text-sm font-medium",children:oe(c.proposer)}),e.jsx("button",{onClick:()=>{mt(c.proposer),U.success("Address copied to clipboard!")},className:"text-primary hover:text-primary/80 transition-colors",children:e.jsx(Ye,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 py-4 border-t border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Asset"}),e.jsx("p",{className:"font-medium",children:pt.getTokenSymbol(c.token)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"font-medium",children:["$",c.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Ends in":"Ended on"}),e.jsx("p",{className:"font-medium",children:l?ct(c.endTime):Ze(c.endTime)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Status"}),e.jsx("p",{className:"font-medium capitalize",children:c.status})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Voting Results"}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("span",{className:"text-sm",children:["For: ",g,"% (",c.forVotes.toLocaleString(),")"]}),e.jsxs("span",{className:"text-sm",children:["Against: ",F,"% (",c.againstVotes.toLocaleString(),")"]})]}),e.jsx("div",{className:"relative w-full h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute left-0 top-0 h-full bg-primary",style:{width:`${g}%`}})})]}),P&&e.jsxs(q,{children:[x?e.jsx(Mt,{className:"h-4 w-4 text-primary"}):e.jsx(St,{className:"h-4 w-4 text-destructive"}),e.jsx(G,{children:"You've voted on this proposal"}),e.jsxs(H,{children:["You voted ",x?"FOR":"AGAINST"," this proposal."]})]}),l&&!P&&e.jsxs(q,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(G,{children:"Voting is open"}),e.jsx(H,{children:"Cast your vote on this proposal. Voting power is determined by your token holdings."})]})]}),e.jsxs(xt,{className:"flex justify-between",children:[l&&!P&&e.jsxs("div",{className:"flex gap-2 w-full justify-end",children:[e.jsx(j,{variant:"destructive",onClick:()=>s(!1),disabled:V||!i,children:V?"Voting...":"Vote No"}),e.jsx(j,{onClick:()=>s(!0),disabled:V||!i,children:V?"Voting...":"Vote Yes"})]}),a&&!c.executed&&e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(j,{onClick:N,disabled:R||!i,children:R?"Executing...":"Execute Proposal"})}),c.executed&&e.jsx("div",{className:"w-full flex justify-end",children:e.jsxs(j,{disabled:!0,variant:"outline",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Executed"]})}),c.status==="failed"&&e.jsx("div",{className:"w-full flex justify-end",children:e.jsxs(j,{disabled:!0,variant:"outline",className:"text-destructive",children:[e.jsx(ut,{className:"mr-2 h-4 w-4"}),"Failed"]})})]})]})]})}function Ss(){const[t]=ht();if(t.startsWith("/asset-dao/proposal/")){const i=t.split("/").pop()||"";return e.jsx(tt,{children:e.jsx(es,{proposalId:i})})}return e.jsx(tt,{children:e.jsx(Zt,{})})}export{Ss as default};
