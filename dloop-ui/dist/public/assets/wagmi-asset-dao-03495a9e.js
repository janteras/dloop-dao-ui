import{r as p,V as d,j as e,h as w,s as E,B as h,K as T,av as D,y as V}from"./index-971aa118.js";import{C as A,c as O}from"./card-66a343e3.js";import{P as W}from"./progress-714fd85c.js";import{C as F}from"./countdown-timer-c1dc32bd.js";import{d as M,e as I,b as j,f as $,a as L,h as B,i as z,S as H}from"./switch-2356becd.js";import{C as R}from"./index-cf00c244.js";import{C as U}from"./copy-943806b5.js";import{D as Y,a as K,b as G,c as q,d as J,L as f,I as Q,e as X}from"./label-d4220aab.js";import{T as Z}from"./textarea-5192e8e4.js";import{S as C,a as k,b as P,c as S,d as v}from"./select-fd573888.js";import{P as _,C as ee}from"./plus-94f21ca1.js";import"./contracts-444c63f0.js";import"./clock-6db2a81c.js";import"./enhanced-assetDaoService-7803e7af.js";import"./chevron-up-4957186b.js";function se(){const{proposals:s,isLoading:n,error:i,totalCount:l,refetch:o}=M({limit:10});return{proposals:s.map(t=>{var a;return{id:t.id,title:`Proposal #${t.id}`,description:t.description,proposer:t.proposer,type:t.proposalType===0?"invest":"divest",token:t.tokenSymbol||"ETH",amount:Number(t.amount),status:ae(t.state),forVotes:t.forVotes,againstVotes:t.againstVotes,endsIn:t.votingEnds?ne(t.votingEnds):"",endTimeISO:(a=t.votingEnds)==null?void 0:a.toISOString()}}),isLoading:n,error:i?String(i):null,totalCount:l,refetch:o}}function te(){const{castVote:s,isPending:n,isConfirming:i,error:l}=I(),{isConnected:o}=j();return{voteOnProposal:p.useCallback(async(t,a)=>{if(!o)throw d.error("Please connect your wallet"),new Error("Wallet not connected");try{return await s(t,a),d.success(`Successfully voted ${a?"for":"against"} proposal ${t}`),!0}catch(r){throw console.error("Error voting on proposal:",r),d.error(r instanceof Error?`Failed to vote: ${r.message}`:"Failed to vote on proposal"),r}},[o,s]),isVoting:n||i,error:l?String(l):null}}function re(){const{executeProposal:s,isPending:n,isConfirming:i,error:l}=$(),{isConnected:o}=j();return{executeProposal:p.useCallback(async t=>{if(!o)throw d.error("Please connect your wallet"),new Error("Wallet not connected");try{return await s(t),d.success(`Successfully executed proposal ${t}`),!0}catch(a){throw console.error("Error executing proposal:",a),d.error(a instanceof Error?`Failed to execute: ${a.message}`:"Failed to execute proposal"),a}},[o,s]),isExecuting:n||i,error:l?String(l):null}}function ae(s){switch(s){case 1:return"active";case 3:return"passed";case 2:case 6:case 7:return"failed";case 5:return"executed";default:return"active"}}function ne(s){const n=new Date,i=s.getTime()-n.getTime();if(i<=0)return"Ended";const l=Math.floor(i/(1e3*60*60*24)),o=Math.floor(i%(1e3*60*60*24)/(1e3*60*60));if(l>0)return`${l}d ${o}h`;{const x=Math.floor(i%36e5/6e4);return`${o}h ${x}m`}}const ie=({proposal:s,onActionComplete:n})=>{const{isConnected:i}=j(),{voteOnProposal:l,isVoting:o}=te(),{executeProposal:x,isExecuting:t}=re(),[a,r]=p.useState(null),b=async m=>{if(!i){d.error("Please connect your wallet first");return}try{await l(s.id,m),n&&n()}catch(u){console.error("Error in vote handler:",u)}},g=async()=>{if(!i){d.error("Please connect your wallet first");return}try{await x(s.id),n&&n()}catch(m){console.error("Error in execute handler:",m)}},y=async m=>{try{await T(m),r(m),d.success("Address copied to clipboard"),setTimeout(()=>r(null),2e3)}catch(u){d.error("Failed to copy address"),console.error("Error copying address:",u)}},c=()=>{switch(s.status){case"active":return"bg-accent/20 text-accent";case"passed":return"bg-green-500/20 text-green-500";case"failed":return"bg-warning-red/20 text-warning-red";case"executed":return"bg-blue-500/20 text-blue-500";default:return"bg-gray/20 text-gray"}};return e.jsx(A,{className:"proposal-card border border-dark-gray hover:cursor-pointer",children:e.jsxs(O,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(w,{variant:"outline",className:`${s.type==="invest"?"bg-green-900/20 text-green-500":"bg-orange-900/20 text-orange-500"} mb-2`,children:s.type==="invest"?"Investment Proposal":"Divestment Proposal"}),e.jsx(w,{variant:"outline",className:c(),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-white",children:s.title}),e.jsx("p",{className:"text-sm text-gray mt-1",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-gray text-xs",children:"Asset"}),e.jsx("span",{className:"text-white text-sm font-medium",children:L(s.token.toString()).symbol})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-gray text-xs",children:s.type==="invest"?"Investment Amount":"Withdrawal Amount"}),e.jsx("span",{className:"text-white text-sm font-medium",children:B(s.amount,s.token.toString())})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray",children:"Type"}),e.jsx("span",{className:`font-medium capitalize ${s.type==="invest"?"text-green-500":"text-orange-500"}`,children:s.type==="invest"?"Investment":"Divestment"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray",children:"Proposer"}),e.jsx("div",{className:"text-white font-medium mono flex items-center",children:s.proposer.startsWith("AI.Gov")?s.proposer:e.jsxs(e.Fragment,{children:[E(s.proposer),e.jsx("button",{onClick:()=>y(s.proposer),className:"ml-1 p-1 hover:bg-dark-bg rounded-full transition-all duration-200",children:a===s.proposer?e.jsx(R,{size:14,className:"text-green-500"}):e.jsx(U,{size:14,className:"text-gray"})})]})})]}),s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray",children:"Ends"}),e.jsx("span",{className:"text-white font-medium",children:s.endsIn})]}),s.endTimeISO&&e.jsx("div",{className:"mt-2 text-sm border border-dark-gray rounded-md p-2 bg-dark-bg transition-all duration-300 hover:border-accent/30",children:e.jsx(F,{endTime:s.endTimeISO,className:"w-full",onComplete:()=>console.log(`Proposal ${s.id} voting has ended`)})})]}):e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray",children:"Result"}),e.jsxs("span",{className:"text-white font-medium",children:[s.forVotes,"% Yes"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray",children:"Votes"}),e.jsxs("span",{className:"text-sm text-white",children:[s.forVotes,"% Yes"]})]}),e.jsx(W,{value:s.forVotes,className:`h-2.5 ${s.status==="passed"?"bg-green-900":s.status==="failed"?"bg-red-900":"bg-dark-bg"}`})]}),s.status==="active"?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>b(!1),disabled:o||!i,children:o?"Voting...":"Vote No"}),e.jsx(h,{variant:"default",size:"sm",onClick:()=>b(!0),disabled:o||!i,className:"bg-green-600 hover:bg-green-700",children:o?"Voting...":"Vote Yes"})]}):s.status==="passed"?e.jsx(h,{variant:"outline",size:"sm",onClick:g,disabled:t||!i,className:"w-full",children:t?"Executing...":"Execute Proposal"}):null]})})},N=[{id:"0xd093d7331448766923fe7ab270a9f6bce63cefda",symbol:"USDC",name:"USD Coin",decimals:6},{id:"0x9c3c9283d3e44854697cd22d3faa240cfb032889",symbol:"WBTC",name:"Wrapped Bitcoin",decimals:8},{id:"0xe5d7c2a44ffddf6b295a15c148167daaaf5cf34f",symbol:"DLOOP",name:"D-Loop Token",decimals:18}],oe=({isOpen:s,onClose:n,onSuccess:i})=>{const{isConnected:l}=j(),{createProposal:o,isPending:x,isConfirming:t}=z(),a=x||t,[r,b]=p.useState({type:"0",token:N[0].id,amount:"",description:""}),g=(c,m)=>{b(u=>({...u,[c]:m}))},y=async c=>{if(c.preventDefault(),!l){d.error("Please connect your wallet first");return}if(!r.token||!r.amount||!r.description){d.error("Please fill in all fields");return}try{if(!N.find(u=>u.id===r.token)){d.error("Invalid token selected");return}await o({token:r.token,amount:r.amount,description:r.description,proposalType:Number(r.type)}),d.success("Proposal created successfully!"),i()}catch(m){console.error("Error creating proposal:",m);const u=m instanceof Error?m.message:"Unknown error";d.error(`Failed to create proposal: ${u}`)}};return e.jsx(Y,{open:s,onOpenChange:n,children:e.jsxs(K,{className:"bg-dark-bg border-dark-gray text-white sm:max-w-[500px]",children:[e.jsxs(G,{children:[e.jsx(q,{className:"text-lg font-semibold",children:"Create New Proposal"}),e.jsx(J,{className:"text-gray-400",children:"Create a new investment or divestment proposal for the DAO to vote on."})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"type",children:"Proposal Type"}),e.jsxs(C,{value:r.type,onValueChange:c=>g("type",c),disabled:a,children:[e.jsx(k,{className:"bg-dark-bg text-white border-dark-gray",children:e.jsx(P,{placeholder:"Select proposal type"})}),e.jsxs(S,{className:"bg-dark-bg text-white border-dark-gray",children:[e.jsx(v,{value:"0",children:"Investment"}),e.jsx(v,{value:"1",children:"Divestment"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"token",children:"Token"}),e.jsxs(C,{value:r.token,onValueChange:c=>g("token",c),disabled:a,children:[e.jsx(k,{className:"bg-dark-bg text-white border-dark-gray",children:e.jsx(P,{placeholder:"Select token"})}),e.jsx(S,{className:"bg-dark-bg text-white border-dark-gray",children:N.map(c=>e.jsxs(v,{value:c.id,children:[c.symbol," - ",c.name]},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"amount",children:"Amount"}),e.jsx(Q,{id:"amount",placeholder:"0.00",type:"number",step:"0.01",value:r.amount,onChange:c=>g("amount",c.target.value),className:"bg-dark-bg text-white border-dark-gray",disabled:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"description",children:"Description"}),e.jsx(Z,{id:"description",placeholder:"Enter proposal description",value:r.description,onChange:c=>g("description",c.target.value),className:"bg-dark-bg text-white border-dark-gray min-h-[100px]",disabled:a})]}),e.jsxs(X,{className:"pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:n,disabled:a,className:"border-dark-gray",children:"Cancel"}),e.jsx(h,{type:"submit",disabled:a||!l,children:a?"Creating...":"Create Proposal"})]})]})]})})},le=()=>{const{isConnected:s}=j(),{proposals:n,isLoading:i,error:l,refetch:o}=se(),[x,t]=p.useState(!1),a=()=>{o()};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Asset DAO"}),e.jsx("span",{className:"ml-3 text-xs px-2 py-1 bg-purple-900/50 text-purple-400 border border-purple-700/50 rounded-full",children:"Wagmi Migration"})]}),s&&e.jsxs(h,{variant:"default",onClick:()=>t(!0),className:"flex items-center",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"New Proposal"]})]}),i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(D,{className:"h-12 w-12"})}):l?e.jsxs("div",{className:"text-center p-8 border border-warning-red/30 rounded-lg bg-warning-red/10",children:[e.jsx("h3",{className:"text-xl font-semibold text-warning-red mb-2",children:"Error Loading Proposals"}),e.jsx("p",{className:"text-gray-300",children:l}),e.jsx(h,{variant:"outline",className:"mt-4",onClick:()=>o(),children:"Retry"})]}):n.length===0?e.jsxs("div",{className:"text-center p-8 border border-dark-gray rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Proposals Yet"}),e.jsx("p",{className:"text-gray mb-4",children:"Be the first to create a proposal for the Asset DAO"}),s?e.jsx(h,{variant:"default",onClick:()=>t(!0),children:"Create Proposal"}):e.jsx("p",{className:"text-sm text-gray",children:"Connect your wallet to create proposals"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(r=>e.jsx(ie,{proposal:r,onActionComplete:a},r.id))}),x&&e.jsx(oe,{isOpen:x,onClose:()=>t(!1),onSuccess:()=>{t(!1),o()}})]})},Ce=()=>{const[s,n]=p.useState(!0);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{href:"/asset-dao",children:e.jsxs(h,{variant:"ghost",className:"mr-2",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Original AssetDAO"]})}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Wagmi Asset DAO - Migration Test"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"migration-mode",checked:s,onCheckedChange:n}),e.jsx(f,{htmlFor:"migration-mode",children:s?"Fully Migrated":"Hybrid Mode"})]})]}),e.jsxs("div",{className:"bg-dark-gray/30 p-4 rounded-md mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-2",children:["Migration Mode: ",s?"Fully Migrated":"Hybrid"]}),e.jsx("p",{className:"text-gray-300 text-sm",children:s?"Viewing fully migrated version using Wagmi hooks for all operations. This version demonstrates the end goal of the migration.":"Viewing hybrid implementation that uses some Ethers.js components with Wagmi hooks. This represents an intermediate migration state."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Migration Improvements:"}),e.jsxs("ul",{className:"text-sm text-gray-300 mt-2 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Better React state management with Wagmi's hooks"}),e.jsx("li",{children:"Properly truncated Ethereum addresses with copy functionality"}),e.jsx("li",{children:"Enhanced token symbol mapping and amount formatting"}),e.jsx("li",{children:"Improved error handling and network validation"}),e.jsx("li",{children:"Fixed proposal type mapping issues"})]})]})]})]}),s?e.jsx(le,{}):e.jsxs("div",{className:"text-center p-8 border border-dark-gray rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Hybrid Mode"}),e.jsx("p",{className:"text-gray mb-4",children:"This would show a version that uses a mix of Ethers and Wagmi components"}),e.jsx(h,{variant:"default",onClick:()=>n(!0),children:"Switch to Fully Migrated Version"})]})]})};export{Ce as default};
