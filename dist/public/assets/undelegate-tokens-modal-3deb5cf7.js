import{c as re,u as I,r as B,w as ne,s as U,j as e,O as i,Q as L,B as N,i as ie,a4 as oe}from"./index-e1be7c10.js";import{o as V,c as $,u as H,t as M}from"./types-4adccaac.js";import{u as Y}from"./PageContainer-8e534529.js";import{D as W,a as G,b as R,c as Z,d as q,L as A,I as Q,e as z}from"./label-89400795.js";import{A as le,T as K}from"./tokenDelegationService-08217fd4.js";import{u as P}from"./useTokenInfo-41555799.js";import{A as S}from"./activity-6a1b6971.js";import{C as ce}from"./circle-check-big-e37d016f.js";import{f as de}from"./api-utils-216de986.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=re("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),J=()=>{const{signer:o,address:m,isConnected:n}=I(),[v,l]=B.useState(!1),c={participants:[{address:m||"0x7C3fA98507fFcD22A62264AeC6afA82099d96DE1",name:m?"You":"AI.Gov#01",type:"Human",votingPower:425e3,accuracy:92,isCurrentUser:!!m,rank:1,delegators:15,performance:18.4,proposalsCreated:22,proposalsVoted:38},{address:"0x9E23fA851681545894f3B3c33BD1E7D22239BDE8",name:"DeFiWhale",type:"Human",votingPower:375e3,accuracy:88,isCurrentUser:!1,rank:2,delegators:8,performance:14.2,proposalsCreated:11,proposalsVoted:35},{address:"0x3A4B670Be17F3a36F8F55BF7C3c7453495A04Ed1",name:"AI.Gov#02",type:"AI Node",votingPower:31e4,accuracy:95,isCurrentUser:!1,rank:3,delegators:12,performance:22.7,proposalsCreated:14,proposalsVoted:48},{address:"0x4B670B1a36F8F55BF7C3c7453495A04EdF3A4576",name:"CryptoSage",type:"Human",votingPower:285e3,accuracy:87,isCurrentUser:!1,rank:4,delegators:7,performance:12.8,proposalsCreated:9,proposalsVoted:27},{address:"0x5C781D367fE20523Be90986CDC75F88B8a0B4546",name:"AI.Gov#03",type:"AI Node",votingPower:26e4,accuracy:93,isCurrentUser:!1,rank:5,delegators:9,performance:19.6,proposalsCreated:12,proposalsVoted:42}],delegations:[{nodeId:"node-1",address:"0x7C3fA98507fFcD22A62264AeC6afA82099d96DE1",amount:12500,since:"2025-03-15T12:00:00Z"},{nodeId:"node-3",address:"0x9E23fA851681545894f3B3c33BD1E7D22239BDE8",amount:7500,since:"2025-04-02T15:30:00Z"},{nodeId:"node-2",address:"0x3A4B670Be17F3a36F8F55BF7C3c7453495A04Ed1",amount:5e3,since:"2025-02-28T09:15:00Z"}]},{data:a,isLoading:j,error:b,refetch:p}=ne({queryKey:["leaderboard"],queryFn:async()=>{try{const t=await de("/api/leaderboard",void 0,c);if(console.log("Leaderboard data received:",t),!t)return console.log("No leaderboard data received, using mock data"),c;let s=[],r=[];return t.participants?(s=Array.isArray(t.participants)?t.participants:[],r=Array.isArray(t.delegations)?t.delegations:[],console.log(`Found structured data: ${s.length} participants, ${r.length} delegations`)):Array.isArray(t)&&(s=t,console.log(`Found array data: ${s.length} items`)),m&&s.length>0&&(s=s.map(w=>{var u;return{...w,isCurrentUser:((u=w.address)==null?void 0:u.toLowerCase())===m.toLowerCase()}})),!s||s.length===0?(console.log("No participants found in API response - Using mock leaderboard data"),c):{participants:s,delegations:r}}catch(t){return console.error("Error fetching leaderboard data:",t),console.log("Using mock data as fallback after error"),c}},enabled:!0,staleTime:60*1e3}),g=async(t,s)=>{if(!n||!o)throw new Error("Wallet not connected");try{return l(!0),console.log(`Delegating ${s} DLOOP to ${t}`),await new Promise(r=>setTimeout(r,2e3)),await p(),!0}catch(r){throw console.error("Error delegating tokens:",r),r}finally{l(!1)}},d=async(t,s)=>{if(!n||!o)throw new Error("Wallet not connected");try{return l(!0),console.log(`Undelegating ${s} DLOOP from ${t}`),await new Promise(r=>setTimeout(r,2e3)),await p(),!0}catch(r){throw console.error("Error undelegating tokens:",r),r}finally{l(!1)}};return{participants:(a==null?void 0:a.participants)||[],delegations:(a==null?void 0:a.delegations)||[],isLoading:j,error:b,refetch:p,delegateTokens:g,undelegateTokens:d,isDelegating:v}},me=V({amount:$.number().min(1e-6,"Amount must be at least 0.000001").refine(o=>o>0,{message:"Amount must be greater than 0"})});function we({isOpen:o,onClose:m,recipientAddress:n,recipientName:v,recipientType:l="AI Node",availableBalance:c,node:a,onSuccess:j}){const b=(a==null?void 0:a.address)||n,p=(a==null?void 0:a.name)||v,g=l||"AI Node",{isConnected:d,signer:t}=I(),{toast:s}=Y(),{refetch:r}=J(),{refetch:w}=P(),{availableBalance:u}=P(),f=c||parseFloat(u),[F,D]=B.useState(!1),x=H({resolver:M(me),defaultValues:{amount:0}}),k=p||U(b||""),C=()=>{x.reset(),m()},X=y=>{try{return ie(y)?{isValid:!0,formattedAddress:oe(y)}:{isValid:!1,error:"The address format is invalid. Please check the address and try again."}}catch(h){return console.warn("Error validating Ethereum address:",y,h),{isValid:!1,error:"Unable to validate the address. Please verify it is correct."}}},_=async y=>{if(!d||!t){s({title:"Not Connected",description:"Please connect your wallet first.",variant:"destructive"});return}if(y.amount>f){s({title:"Insufficient Balance",description:`You have only ${f} DLOOP available to delegate.`,variant:"destructive"});return}D(!0);try{const h=X(b||"");if(!h.isValid){s({title:"Invalid Address",description:h.error||"The recipient address is invalid.",variant:"destructive"}),D(!1);return}if(!t)throw new Error("No signer available, please reconnect your wallet");await K.delegateTokens(t,h.formattedAddress||"",y.amount.toString()),r(),w(),s({title:"Delegation Successful",description:`You have successfully delegated ${y.amount} DLOOP to ${k}.`}),j&&j(),C()}catch(h){console.error("Error delegating tokens:",h),s({title:"Delegation Failed",description:h.message||"There was an error delegating your tokens. Please try again.",variant:"destructive"})}finally{D(!1)}},ee=()=>{x.setValue("amount",f)},te={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},T={hidden:{y:10,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:24}}},se=x.watch("amount"),O=parseFloat(se.toString())||0,ae=Math.floor(O*.08);return e.jsx(W,{open:o,onOpenChange:C,children:e.jsx(G,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:x.handleSubmit(_),children:[e.jsxs(R,{children:[e.jsx(i.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.3},children:e.jsxs(Z,{className:"text-center flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Delegate DLOOP Tokens"}),l==="AI Node"?e.jsx(L,{className:"h-5 w-5 text-purple-500"}):e.jsx(E,{className:"h-5 w-5 text-blue-500"})]})}),e.jsx(i.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.3},children:e.jsxs(q,{className:"text-center",children:["Delegate your DLOOP tokens to ",k," (",l,").",e.jsx("br",{}),"Delegated tokens will increase their voting power while still remaining in your wallet."]})})]}),e.jsxs(i.div,{className:"grid gap-4 py-4",variants:te,initial:"hidden",animate:"show",children:[e.jsxs(i.div,{className:"flex justify-between items-center p-2 rounded-lg bg-muted/50",variants:T,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center mr-2 ${g==="AI Node"?"bg-purple-100 text-purple-500":"bg-blue-100 text-blue-500"}`,children:g==="AI Node"?e.jsx(L,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"})}),e.jsx(A,{children:"Recipient"})]}),e.jsx("span",{className:"text-sm font-medium",children:k})]}),e.jsxs(i.div,{className:"flex justify-between items-center p-2 rounded-lg bg-muted/50",variants:T,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 bg-green-100 text-green-500 rounded-full flex items-center justify-center mr-2",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx(A,{children:"Available Balance"})]}),e.jsxs("span",{className:"text-sm font-medium",children:[f?f.toLocaleString():"0"," DLOOP"]})]}),e.jsxs(i.div,{className:"grid gap-3",variants:T,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(A,{htmlFor:"amount",className:"text-base",children:"Amount to Delegate"}),e.jsx(i.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(N,{type:"button",variant:"outline",className:"h-10 px-4 text-sm rounded-full",onClick:ee,children:"Max"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{id:"amount",type:"number",step:"0.000001",placeholder:"0.0",className:"transition-all duration-200 focus:ring-2 focus:ring-offset-1 focus:ring-primary h-12 text-lg px-4 rounded-md",...x.register("amount")}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none",children:e.jsx("span",{className:"text-base font-medium",children:"DLOOP"})})]}),x.formState.errors.amount&&e.jsx(i.p,{className:"text-sm text-destructive",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:x.formState.errors.amount.message})]}),O>0&&e.jsx(i.div,{className:"p-3 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-900",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{type:"spring",stiffness:300,damping:24},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i.div,{animate:{rotate:[0,10,0]},transition:{duration:.5,repeat:1/0,repeatType:"reverse",repeatDelay:2},children:e.jsx(le,{className:"h-4 w-4 text-green-500 mr-2"})}),e.jsx("span",{className:"text-sm",children:"Voting power boost"})]}),e.jsxs("div",{className:"font-medium text-green-600",children:["+",ae.toLocaleString()]})]})})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3 mt-2",children:[e.jsx(i.div,{whileHover:{scale:.98},whileTap:{scale:.95},className:"w-full sm:w-auto",children:e.jsx(N,{type:"button",variant:"outline",onClick:C,className:"w-full h-12 text-base",children:"Cancel"})}),e.jsx(i.div,{whileHover:{scale:1.03},whileTap:{scale:.97},className:"w-full sm:w-auto",children:e.jsx(N,{type:"submit",disabled:F||O<=0,className:"relative group overflow-hidden w-full h-12 text-base font-medium",children:F?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(i.div,{animate:{rotate:360},transition:{duration:1.5,repeat:1/0,ease:"linear"},children:[e.jsx(S,{className:"h-5 w-5"})," "]}),e.jsx("span",{children:"Delegating..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-center gap-2",children:["Delegate Tokens",e.jsx(ce,{className:"h-5 w-5"})," "]}),e.jsx("span",{className:"absolute inset-0 bg-primary/10 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left"})]})})})]})]})})})}const ue=V({amount:$.number().min(1e-6,"Amount must be at least 0.000001").refine(o=>o>0,{message:"Amount must be greater than 0"})});function Ne({isOpen:o,onClose:m,delegation:n,onSuccess:v}){const{isConnected:l,signer:c}=I(),{toast:a}=Y(),{refetch:j}=J(),{refetch:b}=P(),[p,g]=B.useState(!1),d=H({resolver:M(ue),defaultValues:{amount:n.amount}}),t=n.toName||U(n.to),s=async u=>{if(!l||!c){a({title:"Not Connected",description:"Please connect your wallet first.",variant:"destructive"});return}if(u.amount>n.amount){a({title:"Invalid Amount",description:`You can only undelegate up to ${n.amount} DLOOP from this delegation.`,variant:"destructive"});return}if(u.amount<=0){a({title:"Invalid Amount",description:"Amount must be greater than 0.",variant:"destructive"});return}g(!0);try{if(!c)throw new Error("No signer available, please reconnect your wallet");await K.undelegateTokens(c,n.to,u.amount.toString()),j(),b(),a({title:"Undelegation Successful",description:`You have successfully undelegated ${u.amount} DLOOP from ${t}.`}),g(!1),v&&v(),r()}catch(f){console.error("Error undelegating tokens:",f),a({title:"Undelegation Failed",description:f.message||"There was an error undelegating your tokens. Please try again.",variant:"destructive"})}finally{g(!1)}},r=()=>{d.reset(),m()},w=()=>{d.setValue("amount",n.amount)};return e.jsx(W,{open:o,onOpenChange:r,children:e.jsx(G,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:d.handleSubmit(s),children:[e.jsxs(R,{children:[e.jsx(Z,{children:"Undelegate DLOOP Tokens"}),e.jsxs(q,{children:["Undelegate your DLOOP tokens from ",t," (",n.toType,"). This will increase your available balance and decrease their voting power."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(A,{children:"Delegated To"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(A,{children:"Currently Delegated"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.amount," DLOOP"]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(A,{htmlFor:"amount",children:"Amount to Undelegate"}),e.jsx(N,{type:"button",variant:"link",className:"h-auto p-0 text-xs",onClick:w,children:"Max"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{id:"amount",type:"number",step:"0.000001",placeholder:"0.0",...d.register("amount")}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"DLOOP"})})]}),d.formState.errors.amount&&e.jsx("p",{className:"text-sm text-destructive",children:d.formState.errors.amount.message})]})]}),e.jsxs(z,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:r,className:"mr-2",children:"Cancel"}),e.jsx(N,{type:"submit",disabled:p,className:"bg-primary hover:bg-primary/90",children:p?e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"Undelegating"}),e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-t-transparent"})]}):"Undelegate Tokens"})]})]})})})}export{we as D,E as U,Ne as a,J as u};
